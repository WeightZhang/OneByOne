<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>LMY-HOME</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">

    <!-- highlight.js -->
    <link rel="stylesheet" href="//libs.cncdn.cn/highlight.js/8.4/styles/tomorrow.min.css">
    <script src="//libs.cncdn.cn/highlight.js/8.4/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- CSS -->                       
    <link rel="stylesheet" href="/statics/css/index.css">
</head>

<body>
    
    <div class="wrap">          
    <!--HEADER-->
<div class="header">
    <div class="logo"> <a href="/index.html"><img src="/images/logo.png" alt=""></a> </div>
    <div class="cssmenu">
        <ul>
            <li><a href="/index.html">HOME</a></li>       
            <li><a href="/blog/">BLOG</a></li>
            <li><a href="/demo/">DEMO</a></li>
            <li><a href="/about/">ABOUT</a></li>
            <li><a href="http://limingyang2012.github.io/cv/">RESUME</a></li>
        </ul>
    </div>
    <div class="top-nav">
        <nav class="clearfix">
            <ul>
                <li><a href="/index.html">HOME</a></li>
                <li><a href="/blog/">BLOG</a></li>
                <li><a href="/demo/">DEMO</a></li>
                <li><a href="/about/">ABOUT</a></li>
                <li><a href="http://limingyang2012.github.io/cv/">RESUME</a></li>
            </ul>
        <a href="#" id="pull">MENU</a> 
        </nav>
    </div>
</div>    
        <div id="container">
    <div class="content">
        <div class="page">
            <div class="post-content">
    <div class="title"><h1>JavaScript作用域和作用域链</h1></div>
    <p class="post-date">Oct 8, 2015</p>
                    
     <p>JavaScript作用域和作用域链学习笔记</p>

<hr />

<ul id="markdown-toc">
  <li><a href="#javascript" id="markdown-toc-javascript">JavaScript作用域</a>    <ul>
      <li><a href="#global-scope" id="markdown-toc-global-scope">1、全局作用域(Global Scope)</a></li>
      <li><a href="#local-scope" id="markdown-toc-local-scope">2、局部作用域(Local Scope)</a></li>
    </ul>
  </li>
  <li><a href="#scope-chain" id="markdown-toc-scope-chain">作用域链（Scope Chain）</a></li>
  <li><a href="#section" id="markdown-toc-section">延长作用域链</a></li>
  <li><a href="#section-1" id="markdown-toc-section-1">重新思考</a></li>
  <li><a href="#section-2" id="markdown-toc-section-2">参考资料：</a></li>
</ul>

<h3 id="javascript">JavaScript作用域</h3>

<p>全局作用域(Global Scope)&amp;局部作用域(Local Scope)</p>

<p>作用域就是变量和函数的可访问范围，控制着变量和函数的可见性与生命周期，在JavaScript中变量的作用域有全局作用域和局部作用域。</p>

<p>单纯的JavaScript作用域还是很好理解的，在一些类C编程语言中花括号内的每一段代码都有各自的作用域，而且变量在声明它们的代码段外是不可见的，称之为块级的作用域，JavaScript容易让初学者误会的地方也在于此，JavaScript并没有块及的作用域，只有函数级作用域：变量在声明它们的函数体及其子函数内是可见的。</p>

<h4 id="global-scope">1、全局作用域(Global Scope)</h4>

<p>最外层函数和在最外层函数外面定义的变量拥有全局作用域</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var name = "李明洋"; //最外层变量
function Fun() { //最外层函数
  var anotherName = "李小洋";
  function sayName() { //内层函数
    onsole.log(anotherName);
  }
  sayName();
}
console.log(name); //李明洋
Fun(); //李小洋
console.log(anotherName); //anotherName is not defined
sayName(); //sayName is not defined
</code></pre>
</div>

<p>所有末定义直接赋值的变量自动声明为拥有全局作用域</p>

<div class="highlighter-rouge"><pre class="highlight"><code>function Fun() {
  name = "李明洋";
  var anotherName = "李小洋";
}
Fun();
console.log(name); //李明洋
console.log(anotherName); //inVariable2 is not defined
</code></pre>
</div>

<p>所有window对象的属性拥有全局作用域 <br />
    window对象的内置属性都拥有全局作用域，例如 <code class="highlighter-rouge">window.name</code>、<code class="highlighter-rouge">window.location</code>、<code class="highlighter-rouge">window.top</code> 等。</p>

<h4 id="local-scope">2、局部作用域(Local Scope)</h4>

<p>和全局作用域相反，局部作用域一般只在固定的代码片段内可访问到，最常见的例如函数内部，所有在一些地方也会看到有人把这种作用域称为函数作用域
。</p>

<p>如 1. 中的变量 <code class="highlighter-rouge">inVariable</code> 和函数 <code class="highlighter-rouge">innerFun</code> 都只拥有局部作用域。</p>

<h3 id="scope-chain">作用域链（Scope Chain）</h3>

<p>在JavaScript中，函数也是对象，实际上，JavaScript里一切都是对象。函数对象和其它对象一样，拥有可以通过代码访问的属性和一系列仅供JavaScript引擎访问的内部属性。其中一个内部属性是[[Scope]]，由ECMA-262标准第三版定义，该内部属性包含了函数被创建的作用域中对象的集合，这个集合被称为函数的作用域链，它决定了哪些数据能被函数访问。</p>

<p>先来看一段代码：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>name="李明洋";  
function t(){  
  var name="李小洋";  
  function s(){  
	var name="小李洋";  
	console.log(name);  
  }  
  function ss(){  
	console.log(name);  
  }  
  s();  
  ss();  
}  
t(); 
</code></pre>
</div>

<p>当执行s时，将创建函数s的执行环境(调用对象),并将该对象置于链表开头，然后将函数t的调用对象链接在之后，最后是全局对象。然后从链表开头寻找变量name,很明显</p>

<p>name是”小李洋”。</p>

<p>但执行ss()时，作用域链是： ss()-&gt;t()-&gt;window,李小洋”</p>

<p>下面看一个很容易犯错的例子：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;head&gt;  
&lt;script type="text/javascript"&gt;  
  function buttonInit(){  
	for(var i=1;i&lt;4;i++){  
	  var b=document.getElementById("button"+i);  
	  b.addEventListener("click",function(){ alert("Button"+i);},false);  
	}  
  }  
  window.onload=buttonInit;  
&lt;/script&gt;  
&lt;/head&gt;  
&lt;body&gt;  
  &lt;button id="button1"&gt;Button1&lt;/button&gt;  
  &lt;button id="button2"&gt;Button2&lt;/button&gt;  
  &lt;button id="button3"&gt;Button3&lt;/button&gt;  
&lt;/body&gt;  
</code></pre>
</div>

<p>当文档加载完毕，给几个按钮注册点击事件，当我们点击按钮时，会弹出什么提示框呢？</p>

<p>很容易犯错，对是的，三个按钮都是弹出：”Button4”,你答对了吗？</p>

<p>当注册事件结束后，i的值为4，当点击按钮时，事件函数即function(){ alert(“Button”+i);}这个匿名函数中没有i,根据作用域链，所以到buttonInit函数中找，此时i的值为4，</p>

<p>所以弹出”button4“。</p>

<h3 id="section">延长作用域链</h3>

<p>有些语句可以在作用域链的前端临时增加一个变量对象，该变量对象会在代码执行后被移除。有两种情况下会发生这种现象。</p>

<ul>
  <li><code class="highlighter-rouge">try-catch</code> 语句中的 <code class="highlighter-rouge">catch</code> 块</li>
  <li><code class="highlighter-rouge">with</code> 语句</li>
</ul>

<p>对 with 来说，将会指定对象添加到作用域链中。对 catch 来说，会创建一个新的变量对象，其中包含的是被抛出的错误对象的声明。</p>

<h3 id="section-1">重新思考</h3>

<p>上面不懂没关系，看看下面的例子你会不会清晰的知道答案。</p>

<p>练习1：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>console.log(a);					
var a = 1;
console.log(a);					
function a (){ console.log(2); }
console.log(a);					
var a = 3;		
console.log(a);					
function a (){ console.log(4); }
console.log(a);	
</code></pre>
</div>

<p>练习2：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var a = 1;
function fn1(){
  console.log(a);						
  var a = 2;
}
fn1();
console.log(a);							
</code></pre>
</div>

<p>练习3：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var a = 1;
function fn1(){
  console.log(a);						
  a = 2;
}
fn1();
console.log(a);							
</code></pre>
</div>

<p>练习4：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var a = 1;
function fn1(a){
  console.log(a);						
  a = 2;
}
fn1();
console.log(a);							
</code></pre>
</div>

<p>练习5：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var a = 1;
function fn1(a){
  console.log(a);						
  a = 2;
}
fn1(a);
console.log(a);							
</code></pre>
</div>

<p>下面公布正确的输出顺序，练习1：<code class="highlighter-rouge">a()</code>(其实是function a (){ console.log(4); })、<code class="highlighter-rouge">1</code>、<code class="highlighter-rouge">1</code>、<code class="highlighter-rouge">3</code>、<code class="highlighter-rouge">3</code>;练习2：<code class="highlighter-rouge">undefined</code>、<code class="highlighter-rouge">1</code>;练习3：<code class="highlighter-rouge">1</code>、<code class="highlighter-rouge">2</code>;练习4：<code class="highlighter-rouge">undefined</code>、<code class="highlighter-rouge">1</code>;练习5：<code class="highlighter-rouge">1</code>、<code class="highlighter-rouge">1</code>。你有没有全部答对呢。是不是很多答案和你想的不一样，要是一样的话下面的就别看了哦。</p>

<p>简单的解题步骤：</p>

<p>步骤1：通读代码找东西，要找<code class="highlighter-rouge">var</code>,<code class="highlighter-rouge">function</code>以及<code class="highlighter-rouge">参数</code>。</p>

<p><code class="highlighter-rouge">a = ...</code>所有的变量，在正式运行代码之前，都提前赋了一个值：undefined。也就是说先找到变量，然后它在运行之前还未定义。<code class="highlighter-rouge">fn1 = function fn1(){ console.log(1); }</code>所有的函数，在正式运行代码之前，都是<code class="highlighter-rouge">整个函数块</code>里面的代码先不用考虑。这就是预解析过程，代码还没执行。			
遇到重名的：只留一个。变量和函数重名了，就只留下函数。</p>

<p>步骤2：</p>

<p>逐行解读代码，也就等价于代码执行阶段。表达式：= + - * / % ++ – ! 参数……表达式可以修改预解析的值！</p>

<p>解读一下第一题：</p>

<p>1)预解析:</p>

<p>先找到a=undefined；
找到function a (){ console.log(2); }，重名了，未定义就被删除了；
找到a=undefined，不过又删除了；
找到function a (){ console.log(4); }根据优先级，删除了function a (){ console.log(2); }。</p>

<p>2）逐行解读代码</p>

<p>第一行console.log(a)，由预解析知道输出应该是<code class="highlighter-rouge">a()</code>(function a (){ console.log(4); });
第二行var a = 1;注意表达式可以修改预解析的值，此时a=1;
第三行console.log(a);	由第二行的a=1知道输出1;
第四行function a (){ console.log(2); };函数申明不是表达式不改变值;
第五行console.log(a);	由第二行的a=1知道输出1;
第六行var a = 3;表达式a = 3;
第七行console.log(a);	由第六行的a=3知道输出3;
第八行function a (){ console.log(4); }函数申明不该表值
第九行console.log(a);	由第六行的a=3知道输出3;</p>

<p>解读一下第二题：</p>

<p>1)预解析:</p>

<p>先找到a=undefined;
找到function fn1(){console.log(a);var a = 2;}，一整块考虑，先不看函数里面的内容。</p>

<p>2）逐行解读代码</p>

<p>第一行var a = 1;表达式改变了a的值由undefined变成了1;
第二行函数function fn1(){console.log(a);var a = 2;},进行了一个函数申明;
第三行执行函数fn1();把函数当做一个单独的作用域和上面一样先预解析然后逐行读代码，首先预解析找到a=undefined，然后逐行读代码，所以函数fn1中的console.log(a)输出为undefined;
* 第四行console.log(a);由第一行表达式知道输出1;</p>

<p>接下来的不做了。</p>

<p>其中第三题首先输出1是因为在函数中没有找到var也没找到函数，所以要到函数外面找，结果函数上面找到了并且表达式赋值了1，所以输出就为1。第二个输出为2，是因为函数中输出结束后对全局变量a进行重新赋值了，改变了a的值。</p>

<p>其中第四题首先输出undefined是因为函数中没有找到var也没找到函数，但是找到了参数a，但是a没有传值进来所以未定义了。所以首先输出undefined，然后开始读a=2但是务必注意此时的a并不是全局的，它是对参数a重新赋值的，仅仅在函数中有用。最后的输出就是1了。</p>

<p>其中第五题自己想吧，原理都是一样的。</p>

<h3 id="section-2">参考资料：</h3>

<p><a href="http://www.laruence.com/2009/05/28/863.html">1、鸟哥：Javascript作用域原理</a></p>

<p><a href="http://www.cnblogs.com/lhb25/archive/2011/09/06/javascript-scope-chain.html">2、理解 JavaScript 作用域和作用域链</a></p>

<p><a href="http://blog.csdn.net/yueguanghaidao/article/details/9568071">3、Js作用域与作用域链详解 </a></p>


                    
    <ul class="pagination">
        
        <li class="previous">
            <a href="/javascript/2015/10/05/oninput&onpropertychange.html">Previous</a>
        </li>
        
        
         <li class="next">
            <a href="/javascript/2015/10/09/JavaScript-closure.html">Next</a>
        </li>
        
    </ul>
</div>

            

<div class="catalog-menu">
    <h3>目&nbsp;&nbsp;录</h3>
    <div class="catalog-menu-content"></div>
</div>


<div class="comment">
    <span>Comments</span>
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="/javascript/2015/10/08/JavaScript-scope" data-title="JavaScript作用域和作用域链" data-url="limingyang2012.github.io/javascript/2015/10/08/JavaScript-scope.html"></div>
    <!-- 多说评论框 end -->
</div>



                   
        </div>       
        
    </div>
</div>



<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    var duoshuoQuery = {short_name:"limingyang2012"};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0] 
            || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
</script>
<!-- 多说公共JS代码 end -->



    
        <!--回到顶部-->
        <a id="returnTop"></a>

    <!-- FOOTER -->
<div class="footer" >
    <p class="copyright">
       	&copy; 
        <span itemprop="copyrightYear">2016</span> 
        <span itemprop="name">&nbsp;limingyang2012</span>
    </p>
</div>
    </div>

    <script src="/statics/js/jquery.min.js"></script>
    <script src="/statics/js/index.js"></script>
    

</body>
</html>
